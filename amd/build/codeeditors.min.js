/**
 * Provides utility methods to setup resizable ace editors into a page.
 * @copyright  Astor Bizard, 2019
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_savpl/codeeditors",["jquery","core/url"],(function($,url){var aceTheme;function setupAceEditors($textareas,aceSize,aceLang){var aceEditor,prevY,$placeholderBeingResized=null;return void 0===aceLang&&(aceLang="plain_text"),$textareas.each((function(){var $textarea=$(this),$editorPlaceholder=$("<div>",{width:"100%",height:aceSize,id:"ace_placeholder_"+$textarea.attr("name"),class:"ace-placeholder"}).insertAfter($textarea);$textarea.hide(),$("<div>",{id:"ace_resize_"+$textarea.attr("name"),class:"ace-resize"}).insertAfter($editorPlaceholder).mousedown((function(event){prevY=event.clientY,$placeholderBeingResized=$editorPlaceholder,event.preventDefault()})),ace.config.set("modePath",url.relativeUrl("/mod/vpl/editor/ace9")),ace.config.set("themePath",url.relativeUrl("/mod/vpl/editor/ace9")),(aceEditor=ace.edit($editorPlaceholder[0])).setOptions({theme:"ace/theme/"+aceTheme,mode:"ace/mode/"+aceLang}),aceEditor.$blockScrolling=1/0,aceEditor.getSession().setValue($textarea.val()),aceEditor.setReadOnly($textarea.is("[readonly]")),$("input[type=submit], .qvpl-buttons button").click((function(){$textarea.val(ace.edit("ace_placeholder_"+$textarea.attr("name")).getValue())}))})),$(window).mousemove((function(event){$placeholderBeingResized&&($placeholderBeingResized.height((function(i,height){return height+event.clientY-prevY})),prevY=event.clientY,ace.edit($placeholderBeingResized[0]).resize(),event.preventDefault())})).mouseup((function(){$placeholderBeingResized=null})),aceEditor}function loadAce(){if("undefined"!=typeof ace)return $.Deferred().resolve();var ACESCRIPTLOCATION=url.relativeUrl("/mod/vpl/editor/ace9");return $.ajax({url:ACESCRIPTLOCATION+"/ace.js",dataType:"script",cache:!0,success:function(){ace.config.set("basePath",ACESCRIPTLOCATION)}})}return{setupFormEditors:function(theme,callback){aceTheme=theme,loadAce().done((function(){setupAceEditors($(".code-editor textarea"),"170px"),callback()}))},setupQuestionEditor:function(theme,$textarea,$setTextButtons,lineOffset,callback){aceTheme=theme,loadAce().done((function(){console.log("TEXTAREA"),console.log($textarea);var aceEditor=setupAceEditors($textarea,"200px",$textarea.data("templatelang"));aceEditor.setOption("firstLineNumber",lineOffset),$setTextButtons.each((function(){var text=$(this).data("text");$(this).removeAttr("data-text"),$(this).click((function(event){aceEditor.getValue()!=text&&aceEditor.setValue(text),event.preventDefault()}))})),callback()}))}}}));

//# sourceMappingURL=codeeditors.min.js.map